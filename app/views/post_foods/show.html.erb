<div class="container mt-5" style="background-color: #E6FFE9; border-radius: 20px;">
<!--食事名とお気に入りボタン-->
  <div class ="row mx-2">
    <h2 class="my-5"><%= @post_food.name %></h2>
    <% if @post_food.favorited_by?(current_user) %>
    <div class = "my-5 btn btn-warning favorite-btn">
      <%= link_to post_food_favorites_path(@post_food), method: :delete do %>
        <i class="fas fa-star" style="color: black;">お気に入りから削除する</i>
      <% end %>
    </div>
    <% else %>
    <div class ="my-5 btn btn-warning favorite-btn">
      <%= link_to post_food_favorites_path(@post_food), method: :post do %>
        <i class="far fa-star" style="color: black;">お気に入りに追加する</i>
      <% end %>
    </div>
    <% end %>
  </div>
<!--投稿情報-->
  <div class="row mx-2">
    <div class="col-sm-6">
      <%= link_to users_show_path(@post_food.user), class: "text-left px-0" do %>
      <%= @post_food.user.last_name %>さんの投稿
      <% end %>
      <div>
        <%= attachment_image_tag @post_food, :food_image, size: "400x350", fallback: "No_Image.jpg", style: "border-radius: 20px;" %>
      </div>
    </div>
    <div class="col-sm-5">
      <div class ="my-5">
        <%= link_to '食事登録に追加する', food_regist_cart_index_path, method: :post, class: "btn btn-info d-block btn-lg" %>
      </div>
      <div>
        <h6 class ="mt-3">＜1食あたり＞</h6>
        <table class="table-bordered" id="table_show">
          <thead>
            <tr>
              <th class="text-center table-success">カロリー</th>
              <td class="text-center bg-light"><%= @post_food.calorie %></td>
            </tr>
            <tr>
              <th class="text-center table-success">たんぱく質</th>
              <td class="text-center bg-light"><%= @post_food.protain %></td>
            </tr>
            <tr>
              <th class="text-center table-success">脂質</th>
              <td class="text-center bg-light"><%= @post_food.fat %></td>
            </tr>
            <tr>
              <th class="text-center table-success">炭水化物</th>
              <td class="text-center bg-light"><%= @post_food.carbon %></td>
            </tr>
          </thead>
        </table>
      </div>
      <div class="mt-5">
        <% if @post_food.user_id == current_user.id %>
          <%= link_to '編集する', edit_post_food_path(@post_food), class: "btn btn-success mx-5" %>
          <%= link_to '投稿を削除する', post_food_path(@post_food), method: :delete, class: "btn btn-danger" %>
        <% end %>
      </div>
    </div>
  </div>
  <div class ="row d-block mt-4 mx-2 introduction">
    <div class="col-sm-6 ">
      <p>
        <%= @post_food.introduction %>
      </p>
    </div>
  </div>
</div>
<!--コメント表示欄-->
<div class ="container">
  <div class ="row mt-5 d-flex flex-column">
    <div class='comment-top'>
      <%= @post_food.food_comments.count %>件のコメント</br>
      【総合評価】<%= @post_food.food_comments.average(:rate).round(1) %>点<span id="star-average" class="ml-3" ></span>
      <script>
          $('#star-average').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: <%= @post_food.food_comments.average(:rate).round(1) %>,
          });
      </script>
    </div>
    <% @post_food.food_comments.each do |food_comment| %>
    <div class="d-flex my-3">
      <div>
        <%= attachment_image_tag food_comment.user, :profile_image, size: "50x50", fallback: "no_image.jpg", style: "border-radius: 20px;" %>
        <div id= "comment-name">
          <%= food_comment.user.last_name %>さん
        </div>
      </div>
      <span id='comment'>
        【評価】<%= food_comment.rate %>点<span id="star-rate-<%= food_comment.id %>" class="ml-3"></span>
        <script>
          $('#star-rate-<%= food_comment.id %>').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: <%= food_comment.rate %>,
          });
          </script></br>
        <%= food_comment.comment %>
      </span>
      <% if food_comment.user_id == current_user.id %>
        <%= link_to '削除', post_food_food_comment_path(food_comment.post_food_id, food_comment), method: :delete, class: "btn btn-danger", style: "height: 40px;" %>
      <% end %>
    </div>
    <% end %>
  </div>
<!--コメント投稿欄-->
  <div class="mt-5", style="border-top: solid 1px green"></div>
  <div class="row mt-5 form-inline">
    <%= form_with(model:[@post_food, @food_comment], local: true, class: "col-sm-12") do |f| %>
    <div class="form-group">
      <div>
      <div class="field d-flex mb-2" id="star">
        <%= f.label :rate, class: "mr-3" %>
        <%= f.hidden_field :rate, id: :review_star %>
      </div>
      <%= f.text_area :comment, rows:'2', class: "form-control",placeholder: "コメントをここに", size: "100x2" %>
      </div>
      <div class="text-right">
        <%= f.submit "送信する", class: "btn btn-lg btn-success ml-3 mt-3 pull-right" %>
      </div>
    </div>
    <% end %>
  </div>
</div>

<script>
$('#star').raty({
  size     : 36,
  starOff:  '<%= asset_path('star-off.png') %>',
  starOn : '<%= asset_path('star-on.png') %>',
  scoreName: 'food_comment[rate]'
});
</script>
